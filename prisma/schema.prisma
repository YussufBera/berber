generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  USER
  BARBER
  ADMIN
}

enum AppointmentStatus {
  PENDING
  CONFIRMED
  COMPLETED
  CANCELLED
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  name      String?
  role      Role     @default(USER)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  // Relations
  bookings  Appointment[]
  barberProfile BarberProfile?
}

model BarberProfile {
    id String @id @default(cuid())
    userId String @unique
    user User @relation(fields: [userId], references: [id])
    
    shopName String
    bio String?
    avatar String?
    
    services Service[]
    appointments Appointment[]
    
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
}

model Service {
    id String @id @default(cuid())
    name String
    duration Int // minutes
    price Float
    
    barberId String
    barber BarberProfile @relation(fields: [barberId], references: [id])
    
    appointments Appointment[]
}

model Appointment {
    id String @id @default(cuid())
    date DateTime
    status AppointmentStatus @default(PENDING)
    
    userId String
    user User @relation(fields: [userId], references: [id])
    
    barberId String
    barber BarberProfile @relation(fields: [barberId], references: [id])
    
    serviceId String
    service Service @relation(fields: [serviceId], references: [id])
    
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
}

model SimpleAppointment {
  id        String   @id @default(cuid())
  name      String
  email     String?
  phone     String?
  date      String   // ISO String
  time      String
  services  String   // JSON string or comma separated
  total     Float
  status    String   @default("pending")
  barber    String?
  createdAt DateTime @default(now())
}

model SimpleService {
  id        String   @id @default(cuid())
  name_de   String
  name_en   String
  name_tr   String
  price     Float
  duration  Int      // minutes
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model BarberAvailability {
  id        String   @id @default(cuid())
  barber    String   // Store name to match current convention
  date      String   // ISO String of the date (YYYY-MM-DD)
  isOff     Boolean  @default(true)
  createdAt DateTime @default(now())

  @@unique([barber, date])
}
